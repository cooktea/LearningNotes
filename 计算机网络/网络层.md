# 网络层
![框架](http://pxjspaae8.bkt.clouddn.com/%E7%BD%91%E7%BB%9C%E5%B1%82.png)

## 概述
网络层关注的问题是源主机如何将分组沿着网络路径送达目的主机。同时避免某些链路或路由器负载过重，某些缺空闲的情况。
### 分组转发
分组转发是当一个分组到达路由器时，路由器将其转发到适当的输出链路。所以路由器必须要维护一张转发表，根据转发表确定分组的转发出口。
### 路由选择
网络层决定分组在网络中的传输的路径称为路由选择。路由选择生成一张路由表，再根据路由表生成转发表。
### 提供的服务
#### 面向连接的服务
面向连接服务的计算机网络称为虚电路网络。该网络在两台计算机进行通信时必须先建立连接，即建立一条端到端的数据链路。之后所有的数据都通过这条数据链路进行传输。当数据传输完毕时再释放这条数据链路。例如电话网。
#### 无连接的服务
无连接服务的网络称位数据报网络。该网络只提供简单灵活、无连接、尽最大努力交付的数据报服务。网络在发送分组时不需要建立连接。所以分组在传送时有可能出错、丢失、重复和失序。
## IP协议
IP协议的配套协议：  
- 地址解析协议（Address Resolution Protocol ， ARP）
- 逆地址解析协议（Reserve Address Resolution Protocol ， RARP）
- 网际控制报文协议（Internet Control Message Protocol ， ICMP）
- 网际组管理协议（Internet Group Management Protocol ， IGMP   
### IP协议及其配套协议
![IP协议及其配套协议](http://pxjspaae8.bkt.clouddn.com/1569054157.015124.jpg)
### 异构网络互连
- 将不同的网络连接起来需要使用的中间设备：   
  1. 物理层使用转发器
  2. 数据链路层使用网桥或桥接器
  3. 网络层使用路由器
  4. 网络层以上使用网关
### IP地址
IP地址是因特网上的每一个主机或路由器的接口分配给一个在全世界范围内唯一的32为标识符。
- 点分十进制：将32位标识符每隔八位使用十进制表示，并在十进制数之间用点隔开。
- IP编址方式：
  1. 分类编址
  2. 划分子网
  3. 无分类编址
#### 分类编址
该分类方式将IP地址划分为若干个固定的类。每一个类都由两个固定长度的字段组成，分别是网络号和主机号。网络号在整个因特网中必须是唯一的，主机号在所在的网络中必须是唯一的。   
IP地址管理机构在分配IP地址时只分配网络号，路由器仅根据主机所连接的网络号进行分组转发，减少了路由表的占用空间和检索时间。  
- IP地址分类     
  ![IP地址分类](http://pxjspaae8.bkt.clouddn.com/1569055595.879577.jpg)
  - A类地址：1 - 126
  - B类地址：128 - 191
  - C类地址：192 - 223
#### 划分子网
IP地址从两级编号变为三级编号，分贝是网络号、子网号和主机号。其中子网号不定长。
#### 无分类编址
- 无分类域间路由选择（CIDR）消除了传统的A、B、C类地址以及子网划分的概念。   
  CIDR将32位的IP地址划分为两个部分，前一部分时不定长的网络前缀，代替网络号来知名网络，后一部分则是主机号，用来指明主机。
- 子网掩码:子网掩码是一个32位的地址掩码，将子网掩码与IP地址相与后得到网络前缀，由此得到该IP地址的网络。该网络的地址为网络前缀后全为0的地址。
- CIRD记法：IP地址后跟一个数字，用/与IP地址隔开，表示该IP地址的子网掩码前面有多少位1。
#### 特殊的IP地址
![特殊的IP地址](http://pxjspaae8.bkt.clouddn.com/%E7%89%B9%E6%AE%8AIP%E5%9C%B0%E5%9D%80.png)
#### IP地址与物理地址
- IP地址是网络层使用的地址
- 物理地址是数据链路层使用的地址
- IP地址放在IP数据报的首部
- 物理地址放在MAC帧的首部
### 地址解析协议ARP
ARP协议是一种能够将IP地址映射到物理地址的协议，该映射自动进行。
- 主机A向局域网中的主机B发送IP数据报：A首先在ARP高速缓存中查找B的IP地址，如果能够查找到，则获取其物理地址后封装成MAC帧进行发送。如果查找不到，则A自动运行ARP，ARP运行过程如下：  
  1. 在局域网广播发送一个ARP分组，其中的信息包含A的IP地址和物理地址以及想要直到IP地址为B的IP地址的物理地址
  2. 局域网中所有运行ARP协议的主机都能收到这条信息，收到信息的主机刷新自己的ARP高速缓存，更新A的IP地址到物理地址的映射信息。
  3. 主机B在收到的信息中发现自己的IP地址，就向A发送ARP响应分组，响应中包含自己的物理地址。同时在自己的ARP高速缓存中写入A的IP地址和物理地址的映射信息。
  4. A收到响应分组后就在高速缓存中写入B的IP地址与物理地址的映射信息。
- ARP高速缓存中的每一条映射信息都有一个生存时间，超过生存时间的映射信息将被删除，以防主机的物理地址发生改变。
### IP数据报
![数据报格式](http://pxjspaae8.bkt.clouddn.com/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png)
### IP数据报转发
## 网际控制报文协议ICMP
### 种类
### 应用
## 路由选择协议
### 基本概念
### 内部网关协议
#### RIP
#### OSPF
### 外部网关协议
## 路由器工作原理
### 路由器构成
### 路由器和交换机比较
## VPN
## NAT
## IP多播
### 基本概念
### IGMP协议
### 多播路由选择协议
## 移动IP
## IPV6
### 数据报
### 编址
### IPV4 2 IPV6